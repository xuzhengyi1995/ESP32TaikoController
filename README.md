# ESP32 Taiko Controller

This Readme is generated by Github Copilot.

| Supported Targets | ESP32 | ESP32-S2 | ESP32-S3 |
| ----------------- | ----- | -------- | -------- |

A custom Taiko drum controller implementation for ESP32 microcontrollers that emulates a USB HID keyboard. This project allows you to create your own Taiko drum controller for rhythm games like Taiko no Tatsujin.

## Features

- Supports two player modes (P1 and P2 inputs)
- Two different input processor versions (v1 and v2) with configurable sensitivity
- Analog sensitive input detection for accurate drum hit sensing
- USB HID keyboard emulation via TinyUSB
- Visual debugging interface
- Configurable thresholds for hit detection and reset

## Hardware Requirements

- ESP32, ESP32-S2, or ESP32-S3 development board
- Piezoelectric sensors or other pressure sensors for drum hits (4 sensors per player)
- USB cable for connection to PC/console

## Pin Configuration

The project uses the following default pin configuration:

### Player 1
- Left DON (Red): GPIO 4
- Left KAT (Blue): GPIO 5
- Right DON (Red): GPIO 6
- Right KAT (Blue): GPIO 7

### Player 2
- Left DON (Red): GPIO 8
- Left KAT (Blue): GPIO 1
- Right DON (Red): GPIO 9
- Right KAT (Blue): GPIO 10

## Getting Started

### Prerequisites

1. Install ESP-IDF (Espressif IoT Development Framework)
2. Set up your development environment according to the [ESP-IDF Getting Started Guide](https://docs.espressif.com/projects/esp-idf/en/latest/get-started/index.html)

### Building and Flashing

1. Clone this repository
2. Navigate to the project directory
3. Configure the project (optional):
   ```
   idf.py menuconfig
   ```
4. Build the project:
   ```
   idf.py build
   ```
5. Flash to your device:
   ```
   idf.py -p <PORT> flash
   ```
6. Monitor the output (optional):
   ```
   idf.py -p <PORT> monitor
   ```

### Configuration

Modify `params.h` to adjust sensitivity, thresholds, and other parameters according to your hardware setup:

- `kTaikoInputProcessorVersion`: Choose between processor versions (1 or 2)
- `kHitThreshold`: Detection thresholds for each pad
- `kResetThreshold`: Reset thresholds for each pad
- `kWindowLength`: Sliding window length for input processing

## Project Structure

```
├── CMakeLists.txt               # Project CMake file
├── main
│   ├── adc_controller.cc/h      # ADC input handling
│   ├── keyboard_taiko_controller.cc/h  # USB HID keyboard emulation
│   ├── main.cc                  # Main application entry
│   ├── params.h                 # Configuration parameters
│   ├── taiko_controller.h       # Controller interface
│   ├── taiko_input_processor*.* # Input processing implementations
│   ├── utils.cc/h               # Utility functions
│   └── visual_debugger.*        # Debugging interface
└── README.md                    # This file
```

## Customization

- Adjust pin configurations in `params.h`
- Modify thresholds based on your sensors' sensitivity
- Choose between input processor versions for different detection algorithms

## License

This project is licensed under the MIT License - see the LICENSE file for details.
